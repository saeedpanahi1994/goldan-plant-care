# ๐ฑ ุณุณุชู ุดูุงุณุง ฺฏุงู - ุญุงูุช ูุนููู ู Pro
## Plant Identification Modes System Documentation

---

## ๐ ุฎูุงุตู ฺฉู (Overview)

ุณุณุชู ุดูุงุณุง ฺฏุงู ุฏุฑ Goldan ุฏู ุญุงูุช ูุชูุงูุช ุฏุงุฑุฏ:

| ูฺฺฏ | ุญุงูุช ูุนููู (Normal) | ุญุงูุช Pro |
|------|-------|----------|
| **ููุจุน ุงุทูุงุนุงุช** | PlantNet API ููุท | PlantNet + Gemini (Fallback) |
| **ุณุฑุนุช** | ุณุฑุน โก | ฺฉู ฺฉูุฏุชุฑ (ุฏูุช ุจุดุชุฑ) |
| **ุฏุฑูุงุช** | ูุชูุณุท | ุจุณุงุฑ ุจุงูุง |
| **ูุฒูู API** | ฺฉู | ุจุดุชุฑ |
| **ุญุฏ ุงุนุชูุงุฏ ูููู** | 30% | 60% |
| **ุฐุฎุฑู ุฏุฑ ุจุงูฺฉ ุงุทูุงุนุงุช** | ุงฺฏุฑ ุงุนุชูุงุฏ โฅ 60% | ุงฺฏุฑ ุงุนุชูุงุฏ โฅ 60% |
| **ููุงุด ูพุดููุงุฏ Pro** | ุงฺฏุฑ ุงุนุชูุงุฏ < 30% | โ |

---

## ๐ ูููฺุงุฑุช ฺฉู (Main Flow)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ุงูุชุฎุงุจ ุญุงูุช ุดูุงุณุง    โ
โ  (Normal / Pro Toggle)   โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ
         โโโ ๐ธ ุขูพููุฏ ุชุตูุฑ
         โ
         โโโ ๐ ุงุฑุณุงู ุจู ุณุฑูุฑ
         โ
         โโโ [ุณุฑูุฑ]
                 โ
                 โโโ ุญุงูุช ูุนูููุ โโโ [PlantNet Only]
                 โ
                 โโโ ุญุงูุช Proุ โโโโโ [PlantNet + Gemini]
                         โ
                         โโโ ูุชุงุฌ
```

---

## ๐ข ููู ุญุงูุช ูุนููู (Normal Mode Flow)

### ูุฑุงุญู:

```
1๏ธโฃ  [Frontend] ุงูุชุฎุงุจ ุญุงูุช: ูุนููู โ
     โโ identifyMode = 'normal'

2๏ธโฃ  [Frontend] ุขูพููุฏ ุชุตูุฑ
     โโ ุชุตูุฑ โ Base64 ุง File

3๏ธโฃ  [Frontend] ุงุฑุณุงู ุฏุฑุฎูุงุณุช
     โโ POST /api/identify
     โโ Body: { image, mode: 'normal' }
     โโ Header: Authorization

4๏ธโฃ  [Backend] ุฏุฑุงูุช ุฏุฑุฎูุงุณุช
     โโ route: POST /identify
     โโ controller: identifyPlantNormalMode()

5๏ธโฃ  [Backend] ุดูุงุณุง ุจุง PlantNet
     โโ ุงุฑุณุงู ุชุตูุฑ ุจู PlantNet API
     โโ ุฏุฑุงูุช ูุชุงุฌ + confidence
     โโ ูุซุงู: { name: 'ฺฏู ุฑุฒ', confidence: 0.85 }

6๏ธโฃ  [Backend] ุจุฑุฑุณ ุงุนุชูุงุฏ
     โโ ุงฺฏุฑ PlantNet ูุงูููู โ suggestPro = true
     โโ ุงฺฏุฑ confidence < 0.30 โ suggestPro = true + lowConfidence = true
     โโ ุงฺฏุฑ confidence >= 0.60 โ ุฐุฎุฑู ุฏุฑ ุจุงูฺฉ ุงุทูุงุนุงุช
     โโ ุงฺฏุฑ confidence < 0.60 โ ููุท ุจุงุฒฺฏุฑุฏุงูุฏู (ุจุฏูู ุฐุฎุฑู)

7๏ธโฃ  [Backend] ุงุฑุณุงู ูุชุงุฌ
     โโ Response: {
          success: true,
          data: { name, scientificName, family, ... },
          suggestPro: true/false,
          lowConfidence: true/false,
          confidence: 0.85
        }

8๏ธโฃ  [Frontend] ููุงุด ูุชุงุฌ
     โโ ุชุตูุฑ + ูุงู ฺฏุงู + ุฎุงููุงุฏู
     โโ ุงุทููุงู: 85%
     โโ ุงฺฏุฑ suggestPro:
          โโ ููุงุด ุจูุฑ ุฒุฑุฏ: "ุจุฑุง ุฏูุช ุจุดุชุฑ Pro ุงุณุชูุงุฏู ฺฉูุฏ"
          โโ ุฏฺฉูู: "ุชูุงุด ุจุง ูุฏู Pro"

9๏ธโฃ  [Frontend] Update Usage
     โโ ูุตุฑู 1 ุดูุงุณุง (identify) ุงุฒ ุญุฏ ููุชฺฏ
```

### ูุซุงู ุงุฒ Response:

```json
{
  "success": true,
  "data": {
    "name": "ฺฏู ุฑุฒ ูุฑูุฒ",
    "scientificName": "Rosa",
    "family": "Rosaceae",
    "healthStatus": "ุณุงูู โ",
    "confidence": 0.72,
    "description": "ฺฏู ุฒุจุง ู ูุนุทุฑ...",
    "needs": {
      "light": "ููุฑ ุฒุงุฏ",
      "water": "ุขุจ ูุนุชุฏู",
      "temperature": "15-25ยฐC"
    }
  },
  "suggestPro": false,
  "lowConfidence": false
}
```

---

## ๐ต ููู ุญุงูุช Pro (Pro Mode Flow)

### ูุฑุงุญู:

```
1๏ธโฃ  [Frontend] ุงูุชุฎุงุจ ุญุงูุช: Pro โญ
     โโ identifyMode = 'pro'

2๏ธโฃ  [Frontend] ุขูพููุฏ ุชุตูุฑ
     โโ ุชุตูุฑ โ Base64

3๏ธโฃ  [Frontend] ุงุฑุณุงู ุฏุฑุฎูุงุณุช
     โโ POST /api/identify
     โโ Body: { image, mode: 'pro' }
     โโ Header: Authorization + API Key

4๏ธโฃ  [Backend] ุฏุฑุงูุช ุฏุฑุฎูุงุณุช
     โโ route: POST /identify
     โโ controller: identifyPlantProMode()

5๏ธโฃ  [Backend] ูุฑุญูู ุงูู: PlantNet
     โโ ุงุฑุณุงู ุชุตูุฑ ุจู PlantNet API
     โโ ุฏุฑุงูุช ูุชุงุฌ + confidence

6๏ธโฃ  [Backend] ุจุฑุฑุณ ูุชุงุฌ PlantNet
     โโ ุงฺฏุฑ confidence >= 0.60
     โ  โโ โ ุงุณุชูุงุฏู ุงุฒ ูุชุฌู PlantNet (ุจุฏูู Gemini)
     โ
     โโ ุงฺฏุฑ confidence < 0.60 ุง ูุงูููู
     โ  โโ ๐ ููู ุจฺฉ ุจู Gemini (ูุฑุญูู ุจุนุฏ)

7๏ธโฃ  [Backend] ูุฑุญูู ุฏูู: Gemini (ุงฺฏุฑ ูุงุฒู)
     โโ ุงุฑุณุงู ุชุตูุฑ + Base64 ุจู Google Gemini
     โโ ุฏุฑุฎูุงุณุช: "ุงู ฺฏุงู ฺุณุชุ"
     โโ ุฏุฑุงูุช ูุชุงุฌ ุฏููโุชุฑ

8๏ธโฃ  [Backend] ุชุฑฺฉุจ ูุชุงุฌ
     โโ ูุงู ฺฏุงู ุงุฒ Gemini
     โโ ูุงู ุนูู + ุฎุงููุงุฏู
     โโ ุชูุถุญุงุช ุฏูู

9๏ธโฃ  [Backend] ุจุฑุฑุณ ููุง
     โโ ุงฺฏุฑ confidence >= 0.60 โ ุฐุฎุฑู ุฏุฑ ุจุงูฺฉ ุงุทูุงุนุงุช
     โโ ุงฺฏุฑ confidence < 0.60 โ ููุท ุจุงุฒฺฏุฑุฏุงูุฏู (ุจุฏูู ุฐุฎุฑู)

๐  [Backend] ุงุฑุณุงู ูุชุงุฌ
     โโ Response: {
          success: true,
          data: { ูุชุงุฌ ุฏูู ุดุงูู Gemini },
          lowConfidence: false,
          confidence: 0.95,
          source: "gemini" (ุงฺฏุฑ ุงุฒ Gemini ุงุณุชูุงุฏู ุดุฏู)
        }

1๏ธโฃ1๏ธโฃ [Frontend] ููุงุด ูุชุงุฌ
     โโ ุชุตูุฑ + ูุงู ฺฏุงู + ูุงู ุนูู
     โโ ุงุทููุงู: 95% (ุจุณุงุฑ ุจุงูุง!)

1๏ธโฃ2๏ธโฃ [Frontend] Update Usage
     โโ ูุตุฑู 1 ุดูุงุณุง Pro (identify_pro) ุงุฒ ุญุฏ ููุชฺฏ
```

### ูุซุงู ุงุฒ Response (Gemini):

```json
{
  "success": true,
  "data": {
    "name": "ฺฏู ุฑุฒ ูุญุด",
    "scientificName": "Rosa canina",
    "family": "Rosaceae",
    "healthStatus": "ุณุงูู โ",
    "confidence": 0.95,
    "description": "ฺฏู ุจุฑฺฏุฒุฏู ฺฉู...",
    "needs": {
      "light": "ููุฑ ุฒุงุฏ",
      "water": "ุขุจ ูุนุชุฏู",
      "temperature": "10-20ยฐC"
    }
  },
  "lowConfidence": false,
  "source": "gemini"
}
```

---

## ๐ฏ ุชุตููุงุช ููุดููุฏ (Decision Logic)

### 1๏ธโฃ ฺู ุฒูุงู PlantNet ฺฉุงู ุงุณุชุ
```
โ PlantNet ุงุนุชูุงุฏ >= 60%
   โโ ูุชุฌู ูุงุจู ูุจููุ ุงุณุชูุงุฏู ูุณุชูู
   โโ ุจุฏูู ูุงุฒ ุจู Gemini
```

### 2๏ธโฃ ฺู ุฒูุงู ูุงุฒ ุจู Gemini ุฏุงุฑูุ
```
โ๏ธ PlantNet ุงุนุชูุงุฏ < 60% ุง ูุงูููู
   โโ ุฏุฑ Pro Mode: ุงุณุชูุงุฏู ุงุฒ Gemini
   โโ ุฏุฑ Normal Mode: ูพุดููุงุฏ Pro
   โโ ุจุงุฒฺฏุฑุฏุงูุฏู suggestPro flag
```

### 3๏ธโฃ ฺู ุฒูุงู ูุชุฌู ุฐุฎุฑู ููโุดูุฏุ
```
โ confidence < 0.60 (ูุฑ ุฏู ุญุงูุช)
   โโ ุนูุช: ุงุนุชูุงุฏ ูพุงู ุจุฑุง ุฐุฎุฑู ุฏุงุฆู
   โโ ููุงุด: ุจุง lowConfidence = true
   โโ ูุซุงู: "ุฏูุช ูพุงู ุงุณุช..."
```

---

## ๐พ ููุงุด ุชุบุฑุงุช ุฏุฑ Frontend

### Mode Selector Toggle:

```tsx
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โก ูุนููู  โ  โญ Pro                     โ
โ  (ุนุงุฏ)    โ  (ุฏููโุชุฑ)                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โข ูุนููู: ุณุจุฒ ุฑูุดู
โข Pro: ูุงุฑูุฌ (Premium)
```

### ูพุดููุงุฏ Pro Banner:

```tsx
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โญ ุจุฑุง ุฏูุช ุจุดุชุฑ ุงุฒ ูุฏู Pro ุงุณุชูุงุฏู ฺฉูุฏ  โ
โ                                              โ
โ         [ุชูุงุด ุจุง ูุฏู Pro]                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ูุตุฑู API ู ุญุฏโูุง ููุชฺฏ

### Subscription Plans:

| ุญุงูุช | Free | Subscriber |
|------|------|-----------|
| **Identify (ูุนููู)** | 5/ููุชู | 40/ููุชู |
| **Identify Pro** | 0/ููุชู | 10/ููุชู |

### ูุซุงู ูุตุฑู:

```
ฺฉุงุฑุจุฑ Free:
โโ ุชูุงุด 1 (Normal): 4/5 ุจุงู
โโ ุชูุงุด 2 (Normal): 3/5 ุจุงู
โโ ุชูุงุด 3 (Pro): โ ูุญุฏูุฏ!
โ  โโ Error: "ุชุนุฏุงุฏ Pro ุชูุงู ุดุฏ"

ฺฉุงุฑุจุฑ Subscriber:
โโ ุชูุงุด 1 (Normal): 39/40 ุจุงู
โโ ุชูุงุด 2 (Pro): 9/10 Pro ุจุงู
โโ ุญุฏ ุจุณุงุฑ ุจุงูุง ุจุฑุง ูุฑ ุฏู
```

---

## ๐ง Implementation Details

### Backend Endpoints:

#### `POST /api/identify` (Normal & Pro)
```
ูุณุฑ: POST /diagnosis/identify
ูพุงุฑุงูุชุฑ mode:
  โโ "normal" โ identifyPlantNormalMode()
  โโ "pro" โ identifyPlantProMode()

Usage Tracking:
  โโ Normal โ action: 'identify'
  โโ Pro โ action: 'identify_pro'
```

#### `POST /api/identify-base64` (Base64 Images)
```
ูุณุฑ: POST /diagnosis/identify-base64
ูพุงุฑุงูุชุฑ mode: "normal" | "pro"
Body: { image: base64String, mode }
```

### Frontend Service:

```typescript
// plantApiService.ts

// ุดูุงุณุง ุจุง Base64
identifyPlantFromBase64(
  base64Image: string,
  mimeType: string,
  mode: 'normal' | 'pro' = 'normal'
)

// ุดูุงุณุง ุจุง File
identifyPlantFromFile(
  file: File,
  mode: 'normal' | 'pro' = 'normal'
)
```

---

## ๐จ UI Flow ุฏุฑ PlantIdentifyScreen

### ูุฑุญูู 1: ุงูุชุฎุงุจ ุญุงูุช
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [ุงูุชุฎุงุจ ุญุงูุช ุดูุงุณุง]                โ
โ  โก ูุนููู  โ  โญ Pro                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุฑุญูู 2: ุขูพููุฏ ุชุตูุฑ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [๐ท ุฏูุฑุจู] [๐ผ๏ธ ฺฏุงูุฑ]                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุฑุญูู 3: ุฏุฑ ุญุงู ุดูุงุณุง
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ ุงุฑุณุงู ุชุตูุฑ                        โ
โ  โณ ุดูุงุณุง ููุดููุฏ                    โ
โ  โณ ุฌุณุชุฌู ุฏุฑ ุจุงูฺฉ ุงุทูุงุนุงุช             โ
โ  โณ ุขูุงุฏูโุณุงุฒ ูุชุงุฌ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุฑุญูู 4: ููุงุด ูุชุงุฌ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐น ฺฏู ุฑุฒ ูุฑูุฒ                        โ
โ  Rosa sp.                            โ
โ  ุฎุงููุงุฏู: Rosaceae                   โ
โ  ุงุทููุงู: 85% โ                      โ
โ                                      โ
โ  [ุงฺฏุฑ suggestPro]                    โ
โ  โญ ุชูุงุด ุจุง ูุฏู Pro                  โ
โ                                      โ
โ  [ุงุถุงูู ุจู ุจุงุบฺู] [ุงุณฺฉู ุฌุฏุฏ]        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐จ ุญุงูุงุช ุฎุตูุต (Edge Cases)

### 1๏ธโฃ ุดูุงุณุง ูุงูููู ุฏุฑ Normal:
```
Normal Mode โ PlantNet ูุงูููู
โ
suggestPro = true
lowConfidence = true
Message: "ุดูุงุณุง ูุงูููู. ุจุฑุง ุฏูุช ุจุดุชุฑ Pro ุงุณุชูุงุฏู ฺฉูุฏ"
```

### 2๏ธโฃ ุงุนุชูุงุฏ ูพุงู ุฏุฑ Normal:
```
Normal Mode โ PlantNet confidence = 25%
โ
suggestPro = true
lowConfidence = true
ูุชุฌู: ููุงุด ุดุฏู ูู ุฐุฎุฑู ููโุดูุฏ
Message: "ุฏูุช ุดูุงุณุง ูพุงู ุงุณุช"
```

### 3๏ธโฃ Gemini ุจู ฺฉูฺฉ ูโุขุฏ:
```
Pro Mode โ PlantNet confidence = 45%
โ
Fallback โ Gemini
โ
Gemini confidence = 90%
โ
ูุชุฌู ููุง: ุงุณุชูุงุฏู ุงุฒ Gemini
source: "gemini"
```

### 4๏ธโฃ ููู ุจูุฏุฌู (Over Quota):
```
checkUsageLimit() โ ูุตุฑู ุจุดุชุฑ ุงุฒ ุญุฏ
โ
Error: "ุชุนุฏุงุฏ ุดูุงุณุง Pro ุชูุงู ุดุฏ"
ุง
"ูุทูุงู ุจุฑุง Pro์ฺฏุฑุฏ ฺฉูุฏ"
```

---

## ๐ ูุซุงู ูุงูุน ุงุฒ Flow

### ุณูุงุฑู: ฺฉุงุฑุจุฑ Free ุงุณฺฉู ูโฺฉูุฏ

```
1. ฺฉุงุฑุจุฑ: ุงูุชุฎุงุจ "ูุนููู"
2. ฺฉุงุฑุจุฑ: ฺฏุฑูุชู ุนฺฉุณ ฺฏู ุบุฑุจ
3. App: POST /api/identify { mode: 'normal' }
4. Backend: PlantNet โ confidence: 25%
5. Backend: Response ุจุง suggestPro: true
6. Frontend: ููุงุด ูุชุฌู + ุจูุฑ Pro
7. ฺฉุงุฑุจุฑ: ฺฉูฺฉ ุจุฑ "ุชูุงุด ุจุง ูุฏู Pro"
8. Frontend: ุชุบุฑ mode ุจู 'pro'
9. App: POST /api/identify { mode: 'pro' }
10. Backend: PlantNet: 25% โ Fallback Gemini
11. Backend: Gemini: confidence 95%
12. Backend: Response ุฏูู (source: gemini)
13. Frontend: ููุงุด ูุชุฌู ุฏูู
14. ูุตุฑู: 1 Identify + 1 Identify_Pro
    (ฺฉุงุฑุจุฑ Free: 4 ูุนููู + 0 Pro ุจุงู = Blocked!)
```

---

## โ Checklist ุชฺฉูู

- [x] Backend: `identifyPlantNormalMode()` ุชุงุจุน
- [x] Backend: `identifyPlantProMode()` ุชุงุจุน
- [x] Backend: `/identify` endpoint ุจุง mode support
- [x] Backend: `/identify-base64` endpoint ุจุง mode support
- [x] Backend: Usage tracking ุจุฑุง identify_pro
- [x] Backend: Low confidence save prevention (< 0.60)
- [x] Frontend: Mode selector toggle UI
- [x] Frontend: Mode description text
- [x] Frontend: Suggest Pro banner
- [x] Frontend: API calls ุจุง mode parameter
- [x] Frontend: Response handling (suggestPro, lowConfidence)
- [x] Frontend: Retry with Pro functionality
- [x] Frontend: Icon size optimization (16px)

---

## ๐ ุฎูุงุตู ููุง

**Normal Mode:**
- โ ุณุฑุน ู ููุฑููโุจูโุตุฑูู
- โ ุจุฑุง ุดูุงุณุง ุณุฑุน ฺฏุงูุงู ูุนููู
- โ ุจุฑุง ฺฏุงูุงู ุบุฑุจ ุง ูุงุฏุฑ ููุงุณุจ ูุณุช

**Pro Mode:**
- โ ุฏููโุชุฑ ู ูพุดุฑูุชู
- โ ุงุณุชูุงุฏู ุงุฒ AI ููุดููุฏ (Gemini)
- โ ุจุฑุง ุดูุงุณุง ุฏูู ฺฏุงูุงู ุบุฑุจ
- โ ฺฉูุฏุชุฑ ู ูุฒูู ุจุดุชุฑ

**ูุชุฌู:**
ฺฉุงุฑุจุฑุงู ูโุชูุงููุฏ ุจู ุฑุงุญุช ุจู ุฏู ุญุงูุช ุงูุชุฎุงุจ ฺฉููุฏ ู ููฺฏุงู ูุงุฒ ุจู ุฏูุช ุจุดุชุฑุ Pro mode ุฑุง ุงุณุชูุงุฏู ฺฉููุฏ! ๐ฑโจ
